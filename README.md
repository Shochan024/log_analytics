# Log Analytics System

This project is a Python-based system for analyzing and extracting data from log files, with specific support for analyzing Rails log files. The system is designed to help with "footprint log analysis" and can be used for extracting key metrics, controller actions, and model data from Rails logs.

## Features

- **Log Extraction**: Extract key information such as metrics, controller actions, and model data from Rails log files.
- **Rails Integration**: Specialized components for analyzing logs generated by a Rails application.
- **Task Automation**: Automated tasks to help with log extraction and processing.
- **Environment Configuration**: Supports environment variables for flexible configuration.
- **Modular Design**: Designed with an extractor module that can be extended to support other log formats.

## Project Structure

```
log_analytics/
│
├── .env                   # Environment configuration file
├── .gitignore              # Git ignore settings
├── logs/                   # Directory for storing log files
├── Pipfile                 # Pipenv configuration for managing dependencies
├── Pipfile.lock            # Lock file for dependencies
├── tasks.py                # Main task automation script
├── tmp/                    # Directory for temporary files
├── view/                   # View layer for visualizing log data
│   ├── base_view.py        # Base class for handling views (TBD)
│   ├── log_view.py         # Class for rendering log data (TBD)
│   └── metrics_view.py     # Class for rendering metrics visualizations (TBD)
├── .python-version         # Python version file for the project
├── extractor/              # Main extractor module
│   ├── log_file_base.py    # Base class for log file processing
│   ├── rails/              # Specialized extractor for Rails logs
│   │   ├── controller.py   # Extracts controller-related data
│   │   ├── model.py        # Extracts model-related data
│   │   ├── metrics.py      # Extracts metrics from logs
│   └── __init__.py         # Module initialization
└── README.md               # Project documentation


```

## Installation

### Prerequisites

- Python 3.8 or later
- Pipenv for dependency management
- Import the rails log files into logs folder

### Steps

1. Clone the repository:

   ```bash
   git clone <repository-url>
   cd log_analytics
   ```

2. Install dependencies using the `Pipfile.lock` file:

   ```bash
   pipenv sync
   ```

3. Set up environment variables:

   Create a `.env` file in the root directory and add the required environment variables:

   ```bash
   HOST=db_host
   USER_NAME=user_name
   PASSWORD=password
   DB_NAME=db_name
   ```

4. Run log extraction tasks using `invoke`:

   The project uses `invoke` for task management. To extract and process Rails log data, run the following command:

   ```bash
   pipenv run invoke <task_name> --variables=<value>
   ```

   This will trigger the extraction process as defined in `tasks.py`.

## Available Commands in `tasks.py`

The following commands are implemented in the `tasks.py` file and can be executed using `invoke`. Each command is designed to handle different aspects of log processing and extraction.

### 1. `export_rails_log_data`

This command exports Rails log data, filtering logs by the specified environment (e.g., production).

**Usage**:
```bash
pipenv run invoke export-rails-log-data --data-folder=<data_folder> --rails-env=<rails_env>
```

**Arguments**:
- `data_folder`: The folder where the extracted log data will be saved.
- `rails_env`: The Rails environment to filter log files (default is `'production'`).

This task processes logs for **Controller**, **Metrics**, and **Model** data and saves the output in TSV format.

---

### 2. `export_rails_system_load_graph`

This command generates a system load graph based on Rails logs.

**Usage**:
```bash
pipenv run invoke export-rails-system-load-graph --data-folder=<data_folder>
```

**Arguments**:
- `data_folder`: The folder where the extracted log data will be saved.

This task extracts system load information from Rails logs and visualizes it in graph form.

---

### 3. `export_rails_metrics_statistics`

This command exports basic statistics of Rails metrics.

**Usage**:
```bash
pipenv run invoke export-rails-metrics-statistics --data-folder=<data_folder> --group-pids=<group_pid_array> --file_name=<output_file_name>
```

**Arguments**:
- `data_folder`: The folder where the extracted statistics will be saved.

This task analyzes Rails metrics data and generates basic statistics, which are then saved in the specified folder.


## Usage

The main functionality is driven by the `tasks.py` script, which can be used to process logs. Logs are expected to be placed in the `logs/` directory, and the system will automatically extract key data from them.

### Extractor

The `extractor/rails/` module contains specialized components for extracting data from Rails logs. This includes:

- **Controller Actions**: Extracted using `controller.py`
- **Model Data**: Extracted using `model.py`
- **Metrics**: Extracted using `metrics.py`

## Future Work

- Implement visualization for the extracted log data in the `view/` directory.
- Add support for more log file formats beyond Rails logs.
- Enhance task automation features for easier log management.

## System Load Graph Methods

### `model_freq_graph(col_wrap=4, height=3)`
This method generates histograms to visualize the frequency of different model classes per process ID (PID). It reads the model data from a TSV file and displays a grid of histograms, with each histogram representing a PID.

- **Parameters**:
  - `col_wrap` (int, optional): Number of columns in the grid. Default is 4.
  - `height` (int, optional): Height of each facet in the grid. Default is 3.

### `metrics_graph(exclude_empty_flg=True)`
This method generates two bar charts:
1. One bar chart displays the total number of views and the duration for each PID.
2. The other bar chart shows the total memory allocation per PID.
It reads the metrics data from a TSV file and allows the option to exclude rows with all metrics being 0.

- **Parameters**:
  - `exclude_empty_flg` (bool, optional): If True, rows where all metrics are zero will be excluded from the charts. Default is True.

### `metrics_boxplot()`
This method generates boxplots to visualize the distribution of the following metrics per PID:
- Views
- Duration
- Allocation
The boxplots provide a quick overview of the variation and distribution of these metrics for each PID.
